/*!
 * Polos JS v1.6.1 - Production Version
 * Core: Responsive Grid, Screen Detection, Event System, Popup
 * Compatible with Polos CSS Framework
 * @copyright 2025 Polos Style - MIT License
 * @link : https://github.com/alicom13/polos
 */
class Polos{constructor(){this.version="1.6.4",this.breakpoints={small:"(max-width: 575.98px)",medium:"(min-width: 576px) and (max-width: 767.98px)",large:"(min-width: 768px)"},this.classes={loading:"lmn-loading",interactive:"js-inpolos",responsive:{show:{small:"d-sm",medium:"d-md",large:"d-lg"},hide:{small:"h-sm",medium:"h-md",large:"h-lg"}},popup:{wrapper:"popup",container:"pop",header:"pop-hd",title:"pop-title",body:"pop-bd",footer:"pop-ft",closeButton:"pop-close",button:"btn",sizePrefix:"pop-",type:{toast:"popup-toast",alert:"pop-alert"}}},this.defaults={animationDuration:300,closeOnBackdrop:!0,toastDuration:5e3},this.currentScreenSize="",this.observers=[],this.activePopups=new Set,this.timeouts=new Map,this._resizeTimeout=null,this._isInitialized=!1,this.init()}detectScreenSize(){const e=this.currentScreenSize;let t="";window.matchMedia(this.breakpoints.large).matches?t="large":window.matchMedia(this.breakpoints.medium).matches?t="medium":window.matchMedia(this.breakpoints.small).matches&&(t="small"),e!==t&&(this.currentScreenSize=t,this.triggerEvent("screenChange",{from:e,to:t,columns:this.getCurrentColumns()}))}getCurrentColumns(){return"large"===this.currentScreenSize?12:"medium"===this.currentScreenSize?8:4}getScreenSize(){return this.currentScreenSize}refresh(){this.detectScreenSize()}manageGrid(e,t){const s=document.querySelector(e);if(!s)return;s.querySelectorAll('[class*="cl-"], [class*="cm-"], [class*="cs-"]').forEach(e=>{e.classList.forEach(t=>{/^(cl|cm|cs)-\d+$/.test(t)&&e.classList.remove(t)})});const o=Array.from(s.children).filter(e=>e.nodeType===Node.ELEMENT_NODE);let i=0;t.forEach((e,t)=>{if(!e)return;let s=null;for(let e=i;e<o.length;e++){const t=o[e];if(!t.hasAttribute("data-polos-grid-processed")){s=t,t.setAttribute("data-polos-grid-processed","true"),i=e+1;break}}s&&(e.large>=1&&e.large<=12&&s.classList.add("cl-"+e.large),e.medium>=1&&e.medium<=8&&s.classList.add("cm-"+e.medium),e.small>=1&&e.small<=4&&s.classList.add("cs-"+e.small))}),s.querySelectorAll("[data-polos-grid-processed]").forEach(e=>{e.removeAttribute("data-polos-grid-processed")})}show(e){document.querySelectorAll(e).forEach(e=>{if(e.hasAttribute("data-polos-original-display")){const t=e.getAttribute("data-polos-original-display");e.style.display=t,"polos"===e.getAttribute("data-polos-hidden-by")&&(e.removeAttribute("data-polos-original-display"),e.removeAttribute("data-polos-hidden-by"))}else e.style.display=""})}hide(e){document.querySelectorAll(e).forEach(e=>{if(!e.hasAttribute("data-polos-original-display")){const t=window.getComputedStyle(e);e.setAttribute("data-polos-original-display",t.display),e.setAttribute("data-polos-hidden-by","polos")}e.style.display="none"})}showOn(e,t){const s={small:"small",medium:"medium",large:"large"}[t];if(!s)return;const o=this.classes.responsive.show[s],i=this.classes.responsive.hide[s];document.querySelectorAll(e).forEach(e=>{e.classList.add(o),e.classList.remove(i)})}hideOn(e,t){const s={small:"small",medium:"medium",large:"large"}[t];if(!s)return;const o=this.classes.responsive.show[s],i=this.classes.responsive.hide[s];document.querySelectorAll(e).forEach(e=>{e.classList.add(i),e.classList.remove(o)})}setLoading(e,t,s=""){document.querySelectorAll(e).forEach(e=>{t?(e.classList.add(this.classes.loading),s&&e.setAttribute("data-polos-loading-text",s)):(e.classList.remove(this.classes.loading),e.hasAttribute("data-polos-loading-text")&&e.removeAttribute("data-polos-loading-text"))})}enhance(e){document.querySelectorAll(e).forEach(e=>{e.classList.add(this.classes.interactive)})}on(e,t=null){if("function"!=typeof e)return null;const s=t||"obs-"+Date.now()+"-"+Math.random().toString(36).slice(2,11);return this.observers.push({id:s,fn:e,timestamp:Date.now()}),s}off(e){let t=-1;return"function"==typeof e?t=this.observers.findIndex(t=>t.fn===e):"string"==typeof e&&(t=this.observers.findIndex(t=>t.id===e)),t>-1&&(this.observers.splice(t,1),!0)}triggerEvent(e,t){this.observers.forEach(s=>{if("function"==typeof s.fn)try{s.fn(e,t)}catch(e){console.error(`Polos: Error in observer ${s.id}`,e)}})}_generatePopupId(e="popup-"){return e+Date.now()+"-"+Math.random().toString(36).slice(2,11)}popup(e={}){const t={title:"",content:"",size:"md",type:"default",alertType:"info",buttons:[{text:"OK",class:this.classes.popup.button+"-primary",action:"close"}],onClose:null,onOpen:null,onConfirm:null,closeOnBackdrop:this.defaults.closeOnBackdrop,...e},s=this._generatePopupId(),o=this.classes.popup;let i="";const n="alert"===t.type||"confirm"===t.type?t.size||"sm":t.size;if("toast"===t.type)i=`<div class="${o.type.toast}" id="${s}">${t.content}</div>`;else if("alert"===t.type)i=`<div class="${o.wrapper}" id="${s}">\n                      <div class="${o.container} ${o.sizePrefix}${n}">\n                        <div class="${o.body}">\n                          <div class="${o.type.alert} ${t.alertType}">${t.content}</div>\n                        </div>\n                        <div class="${o.footer}">\n                          <button class="${o.button}-primary" data-polos="close">OK</button>\n                        </div>\n                      </div>\n                    </div>`;else if("confirm"===t.type)i=`<div class="${o.wrapper}" id="${s}">\n                      <div class="${o.container} ${o.sizePrefix}${n}">\n                        <div class="${o.body}">\n                          <div class="${o.type.alert} ${t.alertType||"info"}">${t.content}</div>\n                        </div>\n                        <div class="${o.footer}">\n                          <button class="${o.button}-secondary" data-polos="close">Batal</button>\n                          <button class="${o.button}-primary" data-polos="confirm">OK</button>\n                        </div>\n                      </div>\n                    </div>`;else{const e=t.title?`<button class="${o.closeButton}" data-polos="close">&times;</button>`:"",n=t.title?`<div class="${o.header}">\n                   <h3 class="${o.title}">${t.title}</h3>${e}\n                 </div>`:"",r=t.buttons.map(e=>`<button class="${e.class}" data-polos="${e.action||"close"}">${e.text}</button>`).join(""),a=t.buttons.length>0?`<div class="${o.footer}">${r}</div>`:"";i=`<div class="${o.wrapper}" id="${s}">\n                      <div class="${o.container} ${o.sizePrefix}${t.size}">\n                        ${n}\n                        <div class="${o.body}">${t.content}</div>\n                        ${a}\n                      </div>\n                    </div>`}document.body.insertAdjacentHTML("beforeend",i);const r=document.getElementById(s);return r._popupOptions=t,t.closeOnBackdrop&&r.addEventListener("click",e=>{e.target===r&&this.closePopup(s)}),t.onOpen&&t.onOpen(),this.activePopups.add(s),s}openPopup(e){const t=document.getElementById(e);if(t){if(t.classList.add("active"),document.body.style.overflow="hidden",t.classList.contains(this.classes.popup.type.toast)){const s=(t._popupOptions?.duration||this.defaults.toastDuration)+this.defaults.animationDuration,o=setTimeout(()=>{t.parentNode&&this.closePopup(e)},s);this.timeouts.set(e,o)}this.triggerEvent("popupOpened",{popupId:e})}}closePopup(e){const t=document.getElementById(e);t&&(this.timeouts.has(e)&&(clearTimeout(this.timeouts.get(e)),this.timeouts.delete(e)),t.classList.remove("active"),this.activePopups.delete(e),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t),0===this.activePopups.size&&(document.body.style.overflow=""),t._popupOptions?.onClose?.()},this.defaults.animationDuration),this.triggerEvent("popupClosed",{popupId:e}))}closeAllPopups(){Array.from(this.activePopups).forEach(e=>this.closePopup(e))}alert(e,t="info",s="",o="sm"){const i=s?`<h4 style="margin-bottom:0.5rem">${s}</h4><p>${e}</p>`:`<p>${e}</p>`,n=this.popup({type:"alert",alertType:t,content:i,size:o});return this.openPopup(n),n}confirm(e,t,s=null,o="sm"){try{const i=this.popup({type:"confirm",content:e,onConfirm:t,onClose:s,size:o});return this.openPopup(i),i}catch(e){return console.error("Polos: Error creating confirm dialog",e),null}}toast(e,t=3e3){const s=this.popup({type:"toast",content:e,duration:t});return this.openPopup(s),s}_handleKeydown(e){if("Escape"===e.key&&this.activePopups.size>0){const e=Array.from(this.activePopups);let t=e[e.length-1];this.closePopup(t)}}_showConfirmErrorFeedback(e,t){const s=e.querySelector('[data-polos="confirm"]');if(s){const e=s.textContent,t=s.className;s.textContent="Error!",s.className=this.classes.popup.button+"-danger",s.disabled=!0,setTimeout(()=>{s.parentNode&&(s.textContent=e,s.className=t,s.disabled=!1)},2e3)}this.triggerEvent("confirmError",{popupId:e.id,error:t.message||t})}debug(){return{version:this.version,screenSize:this.currentScreenSize,columns:this.getCurrentColumns(),observers:this.observers.length,activePopups:Array.from(this.activePopups),timeouts:Array.from(this.timeouts.keys()),initialized:this._isInitialized}}destroy(){this.closeAllPopups(),this.timeouts.forEach((e,t)=>{clearTimeout(e)}),this.timeouts.clear(),this._resizeTimeout&&(clearTimeout(this._resizeTimeout),this._resizeTimeout=null);["data-polos-original-display","data-polos-hidden-by","data-polos-loading-text","data-polos-grid-processed"].forEach(e=>{document.querySelectorAll(`[${e}]`).forEach(t=>{t.removeAttribute(e)})}),this.observers=[],this.activePopups.clear(),window.Polos===this&&(window.Polos=null),this._isInitialized=!1}reinit(){return this._isInitialized&&(console.warn("Polos: Already initialized. Destroying first..."),this.destroy()),console.log("Polos: Re-initializing..."),this.init(),!0}init(){if(this._isInitialized)return console.error("Polos: Already initialized! Use .reinit() to force re-initialization."),console.error("Polos: Calling init() multiple times may cause memory leaks."),!1;this.detectScreenSize();window.addEventListener("resize",()=>{this._resizeTimeout&&clearTimeout(this._resizeTimeout),this._resizeTimeout=setTimeout(()=>{this.detectScreenSize()},100)});window.addEventListener("keydown",e=>this._handleKeydown(e));document.addEventListener("click",e=>{const t=e.target.closest("[data-polos]");if(!t)return;const s=t.dataset.polos,o=t.dataset.polosTarget,i=t.dataset.polosClass;try{switch(s){case"popup":o&&this.openPopup(o.replace("#",""));break;case"close":const e=t.closest("."+this.classes.popup.wrapper);e&&this.closePopup(e.id);break;case"confirm":const s=t.closest("."+this.classes.popup.wrapper);if(s){if("confirm"===s._popupOptions?.type&&s._popupOptions?.onConfirm)try{s._popupOptions.onConfirm()}catch(e){return void this._showConfirmErrorFeedback(s,e)}this.closePopup(s.id)}break;case"toggle-class":o&&i&&document.querySelectorAll(o).forEach(e=>{e.classList.toggle(i)})}}catch(e){console.error("Polos: Error handling data attribute",e)}});return window.addEventListener("beforeunload",()=>{this.closeAllPopups()}),this.triggerEvent("initialized",{version:this.version,timestamp:(new Date).toISOString()}),this._isInitialized=!0,!0}}window.Polos?(console.warn("Polos: Instance already exists. Using existing instance."),console.warn("Polos: Use window.Polos.reinit() to force re-initialization.")):(window.Polos=new Polos,console.log(`Polos JS v${window.Polos.version} initialized`));const PolosInstance=window.Polos;"undefined"!=typeof module&&module.exports&&(module.exports=Polos);