/*!
 * Py v1.0.0 - Polos Tiny HTTP Client Library
 * Production-ready, minimal, readable
 * Author: Ali Musthofa
 * License: MIT
 * Link : https://github.com/alicom13/polos
 */
!function(e){function t(e={}){const r=encodeURIComponent,o={timeout:1e4,headers:{accept:"application/json, */*"},responseType:"json",throwIfNot2xx:!0,hooks:{bReq:[],aRes:[],bErr:[]},...e},s=new Map;let n=0;const a=e=>Object.fromEntries(Object.entries(e||{}).map(([e,t])=>[e.toLowerCase(),t])),i=(e,t,o)=>{const s=[],n=o?`${o}[${e}]`:e;if(null==t)return s;if(t instanceof Date)s.push(`${r(n)}=${r(t.toISOString())}`);else if(Array.isArray(t))t.forEach((e,t)=>{"object"==typeof e?s.push(...i("",e,`${n}[${t}]`)):s.push(`${r(n)}[${t}]=${r(e)}`)});else if("object"==typeof t)for(const[e,r]of Object.entries(t))s.push(...i(e,r,n));else s.push(`${r(n)}=${r(t)}`);return s},c=(e,t)=>{let r;try{if(e.match(/^https?:\/\//))r=new URL(e);else{const t=o.baseURL||("undefined"!=typeof window?window.location.origin:null);if(!t)throw new Error(`Relative URL "${e}" requires a baseURL in Node.js/non-browser.`);r=new URL(e,t)}return t&&(r.search=(e=>Object.entries(e).flatMap(([e,t])=>i(e,t)).join("&"))(t)),r.toString()}catch(t){throw new Error(`Invalid URL: ${e}. ${t.message}`)}},l=(e,t,r)=>{if(t)for(const[o,s]of Object.entries(t)){const t=r?`${r}[${o}]`:o;null!=s&&(s instanceof Date?e.append(t,s.toISOString()):s instanceof Blob||s instanceof File?e.append(t,s):Array.isArray(s)?s.forEach((r,o)=>{"object"==typeof r?l(e,r,`${t}[${o}]`):e.append(`${t}[${o}]`,r)}):"object"==typeof s?l(e,s,t):e.append(t,s))}};async function u(e,t,r,i={}){const l=`py_${Date.now()}_${++n}_${Math.random().toString(36).slice(2,9)}`,u=new AbortController,f=setTimeout(()=>u.abort(),i.timeout??o.timeout),{signal:d,cleanup:h}=((e,t)=>{if(!e)return{signal:t.signal,cleanup:()=>{}};const r=new AbortController,o=()=>r.abort();return e.addEventListener("abort",o),t.signal.addEventListener("abort",()=>r.abort(),{once:!0}),{signal:r.signal,cleanup:()=>{e.removeEventListener("abort",o)}}})(i.signal,u),p={bReq:[...o.hooks.bReq,...i.hooks?.bReq||[]],aRes:[...o.hooks.aRes,...i.hooks?.aRes||[]],bErr:[...o.hooks.bErr,...i.hooks?.bErr||[]]};let b={...o,...i,mtd:e,url:t,data:r,sig:d,hdr:{...a(o.headers),...a(i.headers)},prms:i.prms};s.set(l,{ctrl:u,fConfig:b});try{p.bReq.length>0&&(b=p.bReq.reduce((e,t)=>{const r=t(e);return void 0!==r?r:e},b));const o={...b.hdr};let s,n=!1;["GET","HEAD"].includes(e)?s=void 0:r instanceof FormData?s=r:null!==r&&"object"==typeof r?(s=JSON.stringify(r),n=!0):s=r,n&&!o["content-type"]&&(o["content-type"]="application/json");const a=await fetch(c(t,b.prms),{method:e,headers:o,body:s,signal:d});let i;switch(clearTimeout(f),b.responseType){case"json":try{i=await a.json()}catch(e){throw new Error(`JSON parse error: ${e.message}`)}break;case"text":default:i=await a.text();break;case"blob":i=await a.blob();break;case"arraybuffer":i=await a.arrayBuffer()}let u={data:i,status:a.status,statusText:a.statusText,headers:a.headers,fConfig:b,requestId:l};if(p.aRes.length>0&&(u=p.aRes.reduce((e,t)=>{const r=t(e);return void 0!==r?r:e},u)),b.throwIfNot2xx&&!a.ok){const e=new Error(a.statusText||`Request failed with status ${a.status}`);throw e.response=u,e}return u}catch(e){clearTimeout(f);let t=e;if(e.response||(t=new Error("AbortError"===e.name?"Request cancelled or timeout":e.message),t.requestId=l),p.bErr.length>0){const e=p.bErr.reduce((e,t)=>{const r=t(e);return void 0!==r?r:e},t);if(e&&void 0!==e.status)return e;t=e}throw t}finally{h(),s.delete(l)}}const f=e=>{const t=s.get(e);return!!t&&(t.ctrl?.abort(),s.delete(e),!0)};return{get:(e,t)=>u("GET",e,null,t),post:(e,t,r)=>u("POST",e,t,r),put:(e,t,r)=>u("PUT",e,t,r),patch:(e,t,r)=>u("PATCH",e,t,r),delete:(e,t)=>u("DELETE",e,null,t),upload:(e,t,{fName:r="file",data:o,...s}={})=>{const n=new FormData;return n.append(r,t),l(n,o),u("POST",e,n,s)},multiUpload:(e,t,{fName:r="files",data:o,...s}={})=>{if(!(t instanceof FileList||Array.isArray(t)))throw new Error("Files must be Array or FileList");const n=new FormData;return Array.from(t).forEach((e,t)=>n.append(`${r}[${t}]`,e)),l(n,o),u("POST",e,n,s)},cancel:f,cancelAll:()=>{for(const e of s.keys())f(e)},create:e=>t({...o,...e,headers:{...o.headers,...e?.headers||{}},hooks:{bReq:[...o.hooks.bReq,...e?.hooks?.bReq||[]],aRes:[...o.hooks.aRes,...e?.hooks?.aRes||[]],bErr:[...o.hooks.bErr,...e?.hooks?.bErr||[]]}}),actReqs:s}}e.Py=t,e.py=t()}("undefined"!=typeof window?window:global);